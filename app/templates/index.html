<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pneumonia Detection</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <!-- Modal-like card -->
  <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-lg">
    <!-- Header -->
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold text-gray-800">Upload Chest X-ray</h2>
      <button onclick="resetForm()" class="text-gray-500 hover:text-gray-700">✕</button>
    </div>

    <!-- Upload area -->
    <label for="file-input" 
           class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
      <div class="flex flex-col items-center justify-center">
        <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5.002 5.002 0 0115.9 6H16a5 5 0 010 10h-1"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 13l-3-3m0 0l-3 3m3-3v12"/>
        </svg>
        <p class="text-sm text-gray-500">Click to upload or drag & drop</p>
      </div>
      <input id="file-input" type="file" class="hidden" accept="image/*" />
    </label>

    <!-- Preview -->
    <div id="preview" class="mt-4 hidden">
      <img id="preview-img" src="" class="w-full h-48 object-contain rounded-lg border" />
    </div>

    <!-- Actions -->
    <div class="flex justify-between mt-6">
      <button onclick="resetForm()" 
              class="px-4 py-2 border rounded-lg text-gray-600 hover:bg-gray-100">Cancel</button>
      <button onclick="submitForm()" 
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Upload & Predict</button>
    </div>

    <!-- Result -->
    <div id="result" class="mt-4 text-center text-gray-700 font-medium"></div>
  </div>

  <script>
    const fileInput = document.getElementById("file-input");
    const preview = document.getElementById("preview");
    const previewImg = document.getElementById("preview-img");
    const resultDiv = document.getElementById("result");

    fileInput.addEventListener("change", () => {
      const file = fileInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          previewImg.src = e.target.result;
          preview.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }
    });

    function resetForm() {
      fileInput.value = "";
      preview.classList.add("hidden");
      resultDiv.innerHTML = "";
    }

    async function submitForm() {
      if (!fileInput.files.length) {
        alert("Please select an image.");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      resultDiv.innerText = "⏳ Processing...";

      try {
        const response = await fetch("/predict", {
          method: "POST",
          body: formData
        });

        const result = await response.json();
        if (result.error) {
          resultDiv.innerHTML = `<p class="text-red-600">❌ ${result.error}</p>`;
        } else {
          resultDiv.innerHTML = `
            <p class="text-lg">Prediction: 
              <span class="font-bold text-blue-600">${result.prediction}</span>
            </p>
            <p class="text-sm text-gray-600">Confidence: ${(result.confidence * 100).toFixed(2)}%</p>
          `;
        }
      } catch (err) {
        resultDiv.innerHTML = `<p class="text-red-600">⚠️ Request failed</p>`;
      }
    }
  </script>

</body>
</html>
